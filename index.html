<!DOCTYPE html>
<html>
<head>
    <title>Loubby AI Voice/Video Chat</title>
    <style>
        #avatar { 
            width: 200px; 
            height: 200px; 
            animation: bounce 2s infinite; /* Bounce animation */
        }
        #status { 
            font-size: 18px; 
        }
        /* Bounce keyframes */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
    </style>
</head>
<body>
    <h1>Loubby AI Voice/Video Chat</h1>
    <img id="avatar" src="/static/ai_avatar.png" alt="AI Avatar">> <!-- Vecteezy avatar -->
    <audio id="audioOutput" autoplay></audio>
    <p id="status">Connecting...</p>
    <script>
        const ws = new WebSocket('ws://localhost:8001/ws');
        const audioOutput = document.getElementById('audioOutput');
        const status = document.getElementById('status');
        let pc;

        ws.onopen = () => {
            status.textContent = "Connected! Starting audio...";
            startAudio();
        };

        ws.onmessage = async (event) => {
            const data = JSON.parse(event.data);
            if (data.sdp) {
                await pc.setRemoteDescription(new RTCSessionDescription(data));
            } else if (data.ice) {
                await pc.addIceCandidate(new RTCIceCandidate(data.ice));
            }
        };

        async function startAudio() {
            pc = new RTCPeerConnection();
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            stream.getTracks().forEach(track => pc.addTrack(track, stream));

            pc.ontrack = (event) => {
                audioOutput.srcObject = event.streams[0];
                status.textContent = "AI is speaking...";
            };

            pc.onicecandidate = (event) => {
                if (event.candidate) {
                    ws.send(JSON.stringify({ ice: event.candidate }));
                }
            };

            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);
            ws.send(JSON.stringify({ sdp: offer.sdp, type: offer.type }));

            fetch('http://localhost:8001/offer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sdp: offer.sdp, type: offer.type })
            }).then(res => res.json()).then(data => {
                pc.setRemoteDescription(new RTCSessionDescription(data));
            });
        }

        ws.onerror = (error) => status.textContent = "Error: " + error.message;
        ws.onclose = () => status.textContent = "Disconnected.";
    </script>
</body>
</html>